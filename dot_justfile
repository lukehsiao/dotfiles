# just manual: https://github.com/casey/just

whoami := env('USER')

_default:
    @just --list

# Install Rust
_rustup:
    #!/usr/bin/env bash
    set -euxo pipefail

    if ! command -v rustup >/dev/null; then
        # Install rustup and Rust stable
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
        source "$HOME/.cargo/env"
        rustup default stable
        rustup update
        echo "Installed Rust"
    else
        rustup default stable
        rustup update
        echo "Rust is already installed."
    fi

# Install d2
_d2:
    curl -fsSL https://d2lang.com/install.sh | sh -s --

# Install Rust core tooling
_rust-core: _rustup
    #!/usr/bin/env bash
    set -euxo pipefail

    # ensure cargo is sourced
    if ! command -v rustup >/dev/null; then
        source "$HOME/.cargo/env"
    fi

    # Install binstall first
    curl -L --proto '=https' --tlsv1.2 -sSf https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh | bash

    cargo binstall -y --locked \
        bacon \
        cargo-audit \
        cargo-bloat \
        cargo-llvm-cov \
        cargo-deny \
        cargo-edit \
        cargo-leptos \
        cargo-mutants \
        cargo-nextest \
        cargo-semver-checks \
        cargo-update \
        choose \
        dircnt \
        flamegraph \
        git-stats \
        leptosfmt \
        openring \
        pgen \
        ren-find \
        rep-grep \
        rimage \
        sqlx-cli \
        star-history \
        talk-timer \
        titlecase \
        toml-fmt \
        typeracer \
        wasm-bindgen-cli

    cargo install --git https://github.com/lukehsiao/tool.git --locked

    # Install tooling for leptos
    rustup target add wasm32-unknown-unknown

    # Install rust-analyzer
    rustup component add rust-analyzer

# Install all core tools
[group('install')]
install-core: 
    brew install \
        aerc \
        asciinema \
        atuin \
        b3sum \
        bat \
        blackhole-2ch \
        bottom \
        codebook-lsp \
        colima \
        coreutils \
        croc \
        difftastic \
        duf \
        dust \
        eza \
        fastfetch \
        fd \
        ffmpeg \
        fish \
        fzf \
        ghostty \
        git \
        git-absorb \
        git-cliff \
        git-delta \
        git-filter-repo \
        git-grab \
        git-lfs \
        git-sizer \
        glow \
        gping \
        helix \
        hexyl \
        hl \
        hyperfine \
        jaq \
        jj \
        jless \
        jq \
        keycastr \
        llvm \
        lychee \
        mise \
        mosh \
        mpv \
        numbat \
        oha \
        onefetch \
        oxipng \
        pandoc \
        pastel \
        pdfcpu \
        postgresql \
        presenterm \
        prettier \
        rage \
        ripgrep \
        rsync \
        ruff \
        samply \
        sd \
        shellcheck \
        shfmt \
        sqlite \
        sshx \
        starship \
        svgo \
        tealdeer \
        tectonic \
        tokei \
        typos-cli \
        typos-lsp \
        typst \
        vscode-langservers-extracted \
        watchexec \
        xh \
        xsv \
        yt-dlp \
        zellij \
        zola \
        zoxide \
        zstd

    brew install --cask flameshot

    just _rust-core
    just _d2

    # build bat themes
    bat cache --build

    @echo "Installed all core tools."
